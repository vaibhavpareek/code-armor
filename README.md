# Jenkins Pipeline for Security Analysis

This repository contains a Jenkins pipeline designed to perform security analysis on Python codebases using the following tools:

- **Bandit** for static analysis of security issues in Python code.
- **Pylint** for analyzing Python code and finding issues such as code style violations.
- **Semgrep** for running security checks using predefined security rulesets for Django and Python.

## Overview

The pipeline runs a series of security and code quality scans on the code changes of the specified repository branch. It will:

1. Fetch and checkout the specified branch from a Bitbucket repository.
2. Set up a virtual environment and install necessary dependencies (Bandit and Pylint).
3. Perform static analysis using Bandit on changed files.
4. Run Pylint to check for code quality issues.
5. Execute Semgrep security scans using Docker.
6. Archive the results and fail the pipeline if critical vulnerabilities are found.

## Pipeline Stages

1. **Initialize**: Prints the repository and branch being analyzed.
2. **Validate Parameters**: Ensures both the repository name and branch name parameters are provided.
3. **Fetch and Checkout Branch via Bitbucket API**: Clones the repository, checks out the branch, and creates a list of changed files by comparing with the `master` branch.
4. **Setup Virtual Environment**: Creates a Python virtual environment and installs Bandit and Pylint.
5. **Run Bandit on Changed Files**: Scans the changed files using Bandit and saves the results in JSON format.
6. **Check for High/Critical Issues**: Parses the Bandit report to check for critical and high-severity issues.
7. **Run Pylint on Changed Files**: Runs Pylint on the changed files and stores the output in JSON format.
8. **Semgrep Security Scan**: Runs Semgrep using Docker on the changed files, utilizing Django and Python rulesets from Semgrep's public registry.
9. **Post Actions**: 
   - Archives the Bandit, Pylint, and Semgrep reports.
   - Cleans up the cloned repository.

## Usage

### Jenkins Pipeline Parameters

The pipeline accepts two parameters:

- **`repo_name`**: The name of the repository to analyze.
- **`branch_name`**: The branch name to check out and run the analysis on.

### Example Jenkins Job

To run this pipeline in Jenkins:

1. Create a new pipeline job.
2. In the pipeline configuration, set the repository and branch you wish to analyze.
3. Start the pipeline. The results of the analysis will be archived in Jenkins.

### Setting Up Credentials

Ensure that your Jenkins instance has a username and password configured for Bitbucket API access. This is done through Jenkins Credentials Manager by creating a `usernamePassword` credential with the ID `<USERNAME>`.

### Running the Pipeline

Once the pipeline is set up, you can trigger it via the Jenkins UI. The pipeline will:

- Clone the specified repository.
- Check out the given branch.
- Run Bandit, Pylint, and Semgrep on the modified files.
- Archive the results for review.

### Reports

- **Bandit Report**: A JSON report of the security scan using Bandit.
- **Pylint Report**: A JSON report from the Pylint scan.
- **Semgrep Report**: A JSON report generated by Semgrep's security scan.

The reports will be archived at the end of the pipeline and can be accessed from the Jenkins job's artifact section.

## Post-Build Actions

- On **success**: If no critical or high-severity issues are found, the build will pass.
- On **failure**: If critical or high-severity issues are detected, the pipeline will fail and provide the details in the Jenkins console output and reports.

## Cleaning Up

After the pipeline finishes, the cloned repository and temporary files will be removed from the workspace to prevent unnecessary storage usage.

## Dependencies

- **Jenkins** with Pipeline plugin.
- **Bitbucket API access** with proper credentials configured.
- **Python** installed on the Jenkins agent to create a virtual environment.
- **Docker** installed on the Jenkins agent to run Semgrep.

## Troubleshooting

- Ensure the credentials for Bitbucket are correctly configured in Jenkins.
- Verify that the repository name and branch name are accurate and exist in Bitbucket.
- Check that the Jenkins agent has Python and Docker installed.

## License

This project is licensed under the MIT License. See the `LICENSE` file for details.
